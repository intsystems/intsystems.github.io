{% assign items = include.items | default: site.blogs %}
{% assign current_lang = include.lang | default: page.lang | default: site.active_lang | default: site.locale %}
{% assign localized = items | where: "lang", current_lang | sort: "date" | reverse %}
{% assign empty_copy = include.empty | default: "New stories are on the way." %}

{% if localized.size == 0 %}
  <div class="blog-empty">
    <p>{{ empty_copy }}</p>
  </div>
{% else %}
  <div class="blog-grid" data-count="{{ localized.size }}">
    {% for post in localized %}
      {% if post.external_url %}
        {% assign destination = post.external_url %}
        {% assign is_external = true %}
      {% else %}
        {% assign destination = post.url | relative_url %}
        {% assign is_external = false %}
      {% endif %}
      {% assign summary_text = post.summary | default: post.excerpt | strip_html | strip_newlines | truncate: 200 %}
      {% assign has_cover = post.cover and post.cover != "" %}
      <article class="blog-card{% if forloop.first %} blog-card--featured{% endif %}">
        <a class="blog-card__link" href="{{ destination }}"{% if is_external %} target="_blank" rel="noopener"{% endif %}>
          <div class="blog-card__cover{% unless has_cover %} blog-card__cover--placeholder{% endunless %}">
            {% if has_cover %}
              <img src="{{ post.cover | relative_url }}" alt="{{ post.title }} cover" loading="lazy" />
            {% else %}
              <span>{{ post.tags | first | default: "Blog" }}</span>
            {% endif %}
          </div>
          <div class="blog-card__body">
            <div class="blog-card__meta">
              <span>{{ post.date | date: "%B %Y" }}</span>
              {% if post.read_time %}
                <span>&#183;</span>
                <span>{{ post.read_time }} min</span>
              {% endif %}
              {% if post.authors %}
                <span>&#183;</span>
                <span>{{ post.authors | join: ", " }}</span>
              {% endif %}
            </div>
            <h3 class="blog-card__title">{{ post.title }}</h3>
            <p class="blog-card__summary">{{ summary_text }}</p>
            {% if post.tags %}
              <ul class="blog-card__tags">
                {% for tag in post.tags %}
                  <li>{{ tag }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </a>
      </article>
    {% endfor %}
  </div>
{% endif %}
